# agentic-logistics-incident-response
Automated supply chain incident response system for PepsiCo using ServiceNow AI Agents and n8n. Calculates financial impact of delivery delays, selects optimal rerouting, and coordinates execution with logistics providers and customer notifications.

## 1. System Overview  

This project is an automated supply chain incident processing system built inside **ServiceNow** and connected with **n8n** for external coordination. The main goal was to help PepsiCo reduce the manual effort that goes into handling unexpected truck breakdowns and delivery delays.  

In the original process, whenever a breakdown occurred, someone had to:  
- Log the issue by hand  
- Notify retail clients like Whole Foods  
- Calculate financial penalties from contracts  
- Pick a new route manually  
- Update multiple systems to show the change  

That process was slow and error-prone.  

What I built was a workflow where ServiceNow AI Agents handle most of this automatically.  
1. The system ingests breakdown notifications directly from Schneider (the logistics provider).  
2. AI Agent 1 calculates penalties for every possible alternate route.  
3. AI Agent 2 picks the optimal reroute, escalates incident urgency if needed, and triggers the **n8n workflow**.  
4. n8n pushes updates out to Schneider, Whole Foods, and back into ServiceNow.  

From PepsiCo’s perspective, this means less manual work, fewer late delivery penalties, and better client satisfaction.  

---

## 2. Business Challenge and Implementation Journey

Since I am still growing as an AI engineer, I approached this project step by step and tried to focus on one part at a time. The biggest challenge was bridging the gap between *how fast incidents occur* and *how slow humans can process them*. My solution evolved into an automated workflow that connects ServiceNow, AI Agents, and n8n to reduce delays, penalties, and missed communication.

---

### Step 1: Scoped Application and Data Model

I created a scoped application in ServiceNow called **PepsiCo Deliveries**. The goal was to isolate logistics records from the global tables, give them their own namespace, and keep version control clean for updates.

Inside the application, I built two custom tables:

#### Delivery Delay Table
This table captures **each breakdown notification** sent from Schneider (the logistics provider) and evolves as AI agents process the disruption.

| Field Name        | Type        | Description |
|-------------------|------------|-------------|
| `route_id`        | Integer (PK) | Primary identifier for the delivery route. Used as the key across all agents and workflows. |
| `truck_id`        | Integer      | ID of the truck experiencing the breakdown. |
| `customer_id`     | Integer      | Links to Supply Agreement table to fetch penalties and delivery rules. |
| `problem_description` | String (4000) | Description of the delay, captured directly from Schneider’s payload. |
| `proposed_routes` | JSON (4000) | List of alternate routes, each with ETA in minutes, distance in miles, and option_id. |
| `calculated_impact` | JSON (4000) | Generated by Agent 1 (Route Financial Analysis). Shows penalty for each route option. |
| `chosen_option`   | JSON (4000) | Generated by Agent 2 (Route Decision). Contains the final route choice. |
| `status`          | String (16) | Workflow state: `pending`, `calculated`, `approved`, `dispatched`. |
| `assigned_to`     | Reference (User) | Execution context for AI Agents. Ensures permissions to update records. |
| `incident_sys_id` | String (32) | Link to the Incident table for traceability. |


<img width="1637" height="573" alt="image" src="https://github.com/user-attachments/assets/b570c492-21d2-49dd-ac74-672140eabe21" />


---

#### Supply Agreement Table
This table defines the **contractual delivery rules** with customers like Whole Foods. Without this data, agents cannot calculate penalties.

| Field Name        | Type        | Description |
|-------------------|------------|-------------|
| `customer_id`     | Integer (PK) | Links back to Delivery Delay. |
| `customer_name`   | String (100) | Human-readable name of the customer. |
| `deliver_window_hours` | Integer | Maximum hours allowed before penalties apply. (Whole Foods = 3 hours) |
| `stockout_penalty_rate` | Integer | Penalty charged per hour of delay. (Whole Foods = $250/hr) |

<img width="1658" height="417" alt="image" src="https://github.com/user-attachments/assets/1dd610d4-22be-421d-843d-cced39aedd2a" />


---

### Step 2: Financial Analysis Agent (Agent 1)

Configured **AI Agent 1** to pick up any record with `status = pending`.  

- Retrieves `proposed_routes` from Delivery Delay table.  
- Looks up the `deliver_window_hours` and `stockout_penalty_rate` from the Supply Agreement table.  
- Runs calculations for each ETA using a custom JavaScript tool.  

I had to build a **Calculated Impacts Script** because the ReAct engine sometimes treated numbers as text. The script parses values properly, subtracts delivery windows, and applies penalties accurately.

<img width="544" height="606" alt="image" src="https://github.com/user-attachments/assets/5fe4f7e2-e47b-48ce-8c03-04b2a47d92f0" />

<img width="1037" height="410" alt="image" src="https://github.com/user-attachments/assets/34edb8d5-3354-41f1-9f9a-46e3e86d77ba" />


---

### Step 3: Route Decision Agent (Agent 2)

Once the financial impacts are calculated, **AI Agent 2** takes over.

- Compares penalties across routes.  
- Considers both penalty cost and distance.  
- Stores the best option as a structured JSON (`chosen_option`).  
- Updates the Delivery Delay record and escalates the linked incident urgency:  
  - High if penalty ≥ $1000  
  - Medium if $500–$999  
  - Low if < $500  

Finally, the agent fires the **n8n webhook** with the `route_id` and `chosen_option`.

> **Screenshot Placeholder**:  


---

### Step 4: External Coordination with n8n

The n8n workflow was set up to take the webhook payload from ServiceNow and branch it into three actions:

1. **Send `execute_route` to Schneider** (carrier).  
2. **Send `notify_delivery_delay` to Whole Foods** (retail client).  
3. **Send `update_execution_status` back to ServiceNow** (for auditing).  

This ensured that the decision made in ServiceNow actually reached external stakeholders without me needing to manually notify anyone.

> **Screenshot Placeholder**:  


---

### Step 5: End-to-End Lifecycle

By the time all four steps are complete, the system has covered the full lifecycle:  

- Breakdown reported → Delivery Delay record created  
- Agent 1 analyzes penalties → Incident created  
- Agent 2 chooses optimal route → Decision stored + incident escalated if needed  
- n8n executes external coordination → Schneider + Whole Foods notified + ServiceNow updated  

What used to take hours now happens in **under 1 minute**.  

---


## 3. Architecture Diagram  

## 4. Solution Overview

The PepsiCo Logistics Breakdown Resolution System provides a closed-loop automation model that connects ServiceNow AI Agents, structured data models, and external coordination through n8n.  

The goal was to move from **manual, error-prone handling of delivery delays** to a **step-by-step automated workflow** that reacts in real time, applies consistent financial logic, and keeps all stakeholders informed.

---

### 3.1 End-to-End Workflow

1. **Breakdown Detected**  
   - A truck delay notification is sent from Schneider (logistics provider).  
   - This arrives in ServiceNow through the MCP Server.  
   - A new record is created in the **Delivery Delay Table** with status `pending`.

<img width="1047" height="371" alt="image" src="https://github.com/user-attachments/assets/bbd99c18-9cd1-4518-a687-ce1341ed4281" />


2. **Financial Analysis (Agent 1)**  
   - The **Route Financial Analysis Agent** retrieves proposed route options and supply agreement terms.  
   - It calculates penalty costs for each route option using the **Calculated Impacts Tool**.  
   - An incident is automatically created in ServiceNow and linked to the delay record.  
   - The Delivery Delay record is updated with the calculated penalties and incident ID.  
   - Status changes to `calculated`.




3. **Route Decision (Agent 2)**  
   - The **Route Decision Agent** evaluates penalties and distances for each option.  
   - It selects the most cost-effective and time-sensitive route.  
   - The chosen route is stored as structured JSON in the Delivery Delay record.  
   - The linked incident urgency is escalated if penalties exceed thresholds.  
   - Status changes to `approved`.  

   > **Screenshot Placeholder**:  
   > ![Route Decision Agent](screenshots/agent2-decision.png)

4. **External Coordination (n8n)**  
   - Once the decision is finalized, Agent 2 calls the **n8n webhook**.  
   - n8n takes the payload and branches execution into three paths:  
     - Notify Schneider with the new route.  
     - Notify Whole Foods of delivery delay and updated ETA.  
     - Push execution status back into ServiceNow for logging.  

  

---

### 3.2 What Makes It Closed-Loop

The system is **closed-loop** because every step feeds back into ServiceNow as the single source of truth:  

- **Input**: Delivery Delay created in ServiceNow.  
- **Processing**: Agents analyze and decide inside ServiceNow.  
- **Execution**: n8n carries out external updates.  
- **Feedback**: Results and status updates return into ServiceNow for auditing.  

This ensures that nothing is handled offline, and all activity — calculations, decisions, and external communications — are logged within the platform.

---

### 3.3 Key Outcomes

- **Faster Resolution**: Hours of manual effort reduced to under 1 minute.  
- **Consistent Penalty Logic**: No more ad-hoc spreadsheets or manual math errors.  
- **Improved Communication**: Clients and providers receive timely updates automatically.  
- **Scalable Design**: The architecture can easily add new customers, penalties, or providers.  

---


## 4. Optimization  

I’ll be upfront, this project stretched me technically. A lot of my focus went into simply getting the workflow running end-to-end without breaking. That said, I was able to add a few optimizations during development and also identified areas for improvement that I’d pursue in the future.  

### 4.1 Optimizations Implemented  

- **Webhook Payload Simplification**  
  Initially, I sent large payloads through the n8n webhook with all route details and penalty calculations. This caused errors when fields didn’t map correctly. I optimized by reducing the payload to just two essentials: `route_id` and `chosen_option`. This made the integration more reliable.  

- **Deterministic Penalty Calculations**  
  Instead of letting the AI agent handle math internally (which sometimes produced inconsistent results), I wrote a **custom JavaScript script** to calculate penalties. This way, every ETA, delivery window, and penalty rate was converted into a clear dollar amount using the same formula.  

- **Error Logging**  
  I wrapped webhook calls with status checks, so each call returned a `status` and `body`. This let me quickly see if something failed, rather than having silent errors.  

### 4.2 Future Optimizations  

- **Caching Supply Agreement Lookups**  
  Right now, every record fetches agreement terms from the Supply Agreement table. For high volume, caching could reduce database calls.  

- **Retry and Backoff Mechanisms**  
  Currently, if a webhook fails, I need to re-run it. A retry with exponential backoff would make the system more resilient.  

- **Monitoring and Dashboards**  
  I want to add ServiceNow dashboards that show how many workflows ran successfully, which ones failed, and average resolution time. That would give better visibility into performance.  

Even though not all of these optimizations are live yet, mapping them out helped me understand how to build for scalability and reliability.  

---

## 5. Testing Results

I tested the end-to-end flow across multiple breakdown scenarios to validate financial analysis, routing decisions, and external execution.  

### 5.1 Scenario 1: Single Delay (Baseline)
- **Input:** Delivery Delay record created with multiple proposed routes.  
- **Expected Behavior:** Agent 1 calculates penalties, Agent 2 selects best route, webhook fires successfully.  
- **Result:** ✅ Success.  
  - Incident created: `INC0010001`  
  - Agent 2 selected Option 2 (lowest penalty, ETA within window).  
  - Webhook fired, Schneider and Whole Foods received payload.  
  - ServiceNow updated record to `dispatched`.  

**Screenshot:**  
![Baseline Execution](screenshots/baseline_execution.png)

---

### 5.2 Scenario 2: Webhook Failure
- **Input:** n8n webhook intentionally disabled to simulate outage.  
- **Expected Behavior:** Agents still process internally, webhook should fail gracefully.  
- **Result:** ❌ Partial success.  
  - Agents completed penalty and route decision.  
  - Webhook call failed (not listening).  
  - No retries attempted, workflow required manual re-run.  

**Lesson Learned:** Retry and backoff logic must be added so transient network failures don’t stop the system.  

**Screenshot:**  
![Webhook Failure](screenshots/webhook_failure.png)


### 5.4 Latency Measurements
Average times across multiple runs:  
- **Agent 1 (Financial Analysis):** 12–20 seconds  
- **Agent 2 (Route Decision):** 15–18 seconds  
- **n8n Workflow (Webhook + MCP calls):** 20–30 seconds  
- **Total Cycle:** ~1 minute  

This is a significant improvement compared to manual workflows that previously took hours.

---

### 5.5 Reflection on Testing
As someone still growing as an AI engineer, this phase was where I learned the most. Debugging AI agents required:  
- Careful handling of JSON structures  
- Consistent memory hand-offs between agents  
- Validation at integration boundaries  

While the system is not perfect, the testing gave me confidence that the architecture is sound and ready for optimization (retries, validation rules, caching).  



### 5.5 Scenario 4: Missing Supply Agreement

**Input**  
Delivery Delay created for a customer without a Supply Agreement record  

**Expected Behavior**  
- Agent 1 should fail gracefully or notify user of missing contract data  

**Result**  
⚠️ Agent failed with **"Null supply agreement"** error  
- No penalties calculated  
- No incident created  

**Lesson Learned**  
Validation rules should prevent creation of Delivery Delay records without a linked Supply Agreement. This is a governance improvement opportunity.

---

### 5.6 End-to-End System Latency

I measured execution time across multiple runs:

| Component                     | Average Duration |
|-------------------------------|------------------|
| Agent 1 (Financial Analysis)  | 12–20 seconds    |
| Agent 2 (Route Decision)      | 15–18 seconds    |
| n8n Workflow (Webhook + MCP)  | 20–30 seconds    |
| **Total Cycle Time**          | ~1 minute        |

This represents a major improvement over manual workflows, which previously took hours.

---

### 5.7 Summary of Test Outcomes

| Scenario               | Success | Notes                                         
|------------------------|---------|-----------------------------------------------|
| Single Delay           | ✅       | Baseline use case executed perfectly           |         
| Webhook Failure        | ❌       | No retry logic, manual re-run required         | 
| Latency                | ✅       | Average ~1 minute, far faster than manual work |

---

### 5.8 Reflection on Testing

As an entry-level engineer, the testing phase was where I learned the most. It was not just about getting a green checkmark, but about seeing where things broke and how the system behaved under stress.

Key takeaways:  
- Debugging AI agents requires careful handling of JSON and memory context.  
- Integration points (like webhooks) are common failure points and need resilience.  
- Validation and governance are just as important as automation logic.  

The system today is not perfect, but it works. I left testing with confidence in the architecture, while also knowing where to push future improvements: **retries, validation, and caching.**

### 5.9 Supporting Screenshots

| Component              | Screenshot |
|------------------------|------------|
| AWS Bedrock Chat Model | <img width="700" src="https://github.com/user-attachments/assets/2126ec2b-fa62-4ba6-ab84-dadc6ab32efb" /> |
| Logistics MCP Client   | <img width="700" src="https://github.com/user-attachments/assets/608809b7-a1d3-46bb-a7ca-ae5acb3fc364" /> |
| Retail MCP Client      | <img width="700" src="https://github.com/user-attachments/assets/9f88a5a3-8570-4858-ad21-1b30800f9bb9" /> |
| ServiceNow MCP Client  | <img width="700" src="https://github.com/user-attachments/assets/201d72ac-8099-4bb3-8edb-df7737a418c1" /> |
| ServiceNow Record      | <img width="500" src="https://github.com/user-attachments/assets/fe3eeb94-bb58-4058-bffd-25a8ed58faa2" /> |




## 6. Business Value

The PepsiCo Logistics Breakdown Resolution System was designed not just as a technical experiment but as a way to solve a real supply chain problem that costs time, money, and customer trust. By moving from manual workflows to AI-driven orchestration, the system delivered measurable improvements in efficiency and reliability.

---

### 6.1 Reduced Manual Intervention

Before this project, dispatchers and analysts had to:  
- Receive breakdown notifications manually  
- Calculate penalties in spreadsheets  
- Negotiate reroutes with logistics providers  
- Update incidents and notify clients  

This process often took hours.  

Now, the system handles these steps automatically:  
- Incidents are created as soon as delays are detected  
- Penalty calculations run instantly using the **Calculated Impacts Tool**  
- Route decisions are made by the **Route Decision Agent** based on cost and timing  
- External updates are pushed automatically to Schneider, Whole Foods, and ServiceNow  

This allows human staff to focus on exceptions and higher-value tasks instead of routine calculations.

---

### 6.2 Optimized Delivery Cost Management

One of the biggest financial impacts came from accurate and consistent penalty calculation.  

- The **Supply Agreement Table** ensures penalties are always calculated according to the correct contractual rules.  
- The **Route Financial Analysis Agent** eliminates errors from manual math or ad-hoc formulas.  
- The system can simulate multiple route options and select the one with the lowest total cost impact.  

This directly reduces financial exposure for PepsiCo during logistics disruptions.

---

### 6.3 Faster Incident Resolution and Communication

Time is critical in logistics. Every hour of delay increases penalty costs and risks customer dissatisfaction.  

With this system:  
- Financial impacts are calculated within 20 seconds  
- Route decisions are finalized within 15–18 seconds  
- External communications via **n8n** happen within 30 seconds  

The full cycle averages about **1 minute**, compared to **hours of manual work** in the old process.  

Clients now receive timely updates, and logistics providers can react faster to breakdowns.

---

### 6.4 Higher Reliability and Transparency

All data is stored inside ServiceNow, creating a single source of truth. This includes:  
- Breakdown details  
- Penalty calculations  
- Route decisions  
- Webhook results  

Executives and managers can now access dashboards showing:  
- How many delays are active  
- Total penalties being incurred  
- Resolution times for each incident  

This transparency builds trust and allows leadership to make better decisions based on real-time data.

---

### 6.5 Scalable Architecture

The system was built as a **scoped application** in ServiceNow, meaning it is modular and extendable.  

- New retail clients can be onboarded by simply adding records to the **Supply Agreement Table**.  
- New logistics providers can be integrated by extending the **n8n workflow** with additional MCP clients.  
- The AI agent framework is reusable for future scenarios like inventory issues, plant disruptions, or international shipments.  

This design choice ensures PepsiCo can reuse the foundation for broader supply chain automation.

---

### 6.6 Personal Reflection

From my perspective as an entry-level AI engineer, this project showed me how AI, automation, and system integration can have a **direct business impact**.  

- I learned how to design AI agents that don’t just reason but actually **take action** inside ServiceNow.  
- I experienced first-hand how fragile JSON formats, webhook calls, and permissions can be when connecting multiple systems.  
- Most importantly, I saw how even a small amount of automation can save **hours of work** and **thousands of dollars** when scaled across hundreds of deliveries.  

The system is not perfect, but it represents a **step forward in how PepsiCo manages disruptions**. It also gave me confidence that AI systems, when implemented carefully, can handle real operational challenges, not just experiments in a lab.

---

### 6.7 Summary

The business value delivered by this system can be summarized as:  

- Reduced manual workload for operations staff  
- Lower penalty costs through consistent, automated calculations  
- Faster incident resolution and communication across partners  
- Reliable, transparent data in ServiceNow  
- Scalable architecture for future supply chain automation  

Overall, this project demonstrated how AI agents, workflows, and integrations can transform logistics from **reactive firefighting** into **proactive automation**.

